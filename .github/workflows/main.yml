name: TGbot
on:
  workflow_dispatch: # 手动触发
jobs:
  AutoDownloaderProcess:
    runs-on: ubuntu-20.04
    steps:


    # 输出IP
    - name: IP
      run: sudo curl ifconfig.me



    # 设置服务器时区为东八区 
    - name: Set time zone
      run: sudo timedatectl set-timezone 'Asia/Shanghai'

    - uses: actions/checkout@v2.1.0
        
    - name: Rclone Install
      run: curl https://rclone.org/install.sh | sudo bash
    - name: Inject Rclone config
      run: |
        mkdir -p ~/.config/rclone/
        cat >  ~/.config/rclone/rclone.conf  << EOF
        ${{ secrets.RCLONE_CONF }}
        EOF
    - name: TG脚本
      run: |
        sudo apt update
        sudo apt install python3.6
        git clone https://github.com/winkxx/telegram_channel_downloader.git
        cd telegram_channel_downloader
        pip3 install -r requirements.txt
        python3 tg_channel_downloader.py
